#!/usr/bin/env bash

xscreensaver -no-splash &

# to restore the last wallpaper used in nitrogen
nitrogen --restore &
#~ bgs ~/Pictures/backgrounds/bw8lw.jpg &

# change the mouse to standard left-pointing
xsetroot -cursor_name left_ptr &

# activate numlock on bootup (https://wiki.archlinux.org/index.php/Activating_Numlock_on_Bootup)
numlockx &

# the following was adapted from c00kiemon5ter's github gist here
# https://gist.github.com/1905427
# gist: monsterwm2dzen_with-titles_dwm-like

tags=(' 1 ' ' 2 ' ' 3 ' ' 4 ')

layouts=("T" "M" "B" "G" "F")

conky -c ~/.config/conky/conky_monsterwm| while read -r; do xsetroot -name "$REPLY"; done &

ff="/tmp/monsterwm.fifo"
[[ -p $ff ]] || mkfifo -m 600 "$ff"

while read -r wmout; do
    desktops=($(cut -d"|" -f1 <<< "$wmout" | tr " " "\n"))
    title=$(cut -d"|" -f2- <<< "$wmout")

    for desktop in "${desktops[@]}"; do
        IFS=':' read -r d w m c u <<< "$desktop"

        # Tags labels
        label="${tags[$d]}"

        # Is this the current desktop ? save the layout
        ((c)) && fg="&0" bg="&B8" && layout="  ${layouts[$m]}" || fg="&3" bg="&B0"

        # Has windows ?
        ((w)) && ((! c)) && fg="&2" bg="&B6" 

        # Urgent windows ?
        ((u)) && fg="&9" bg="&B0"

        tmp+="$fg$bg$label"
    done

    echo "$tmp&B0&2$layout  &B5&2$title" && unset tmp

done < "$ff" | bipolarbar &

monsterwm > "$ff"

rm $ff
