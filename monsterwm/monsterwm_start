#!/usr/bin/env bash

xscreensaver -no-splash &

# to restore the last wallpaper used in nitrogen
nitrogen --restore &

# change the mouse to standard left-pointing
xsetroot -cursor_name left_ptr &

#exec monsterwm
# from arch user stlarch

ff="/tmp/monsterwm.fifo"
[[ -p $ff ]] || mkfifo -m 600 "$ff"

ds=(" 1 " " 2 " " 3 " " 4 ")

ms=("T" "M" "B" "G" "F")

while read -t 60 -r wmout || true; do
    if [[ $wmout =~ ^(([[:digit:]]+:)+[[:digit:]]+ ?)+$ ]]; then
        unset r
        read -ra desktops <<< "$wmout"
        for desktop in "${desktops[@]}"; do
            IFS=':' read -r d w m c u <<< "$desktop"
            
            #~ ((c)) => current desktop
            ((c)) && fg="&0" bg="&B9" i="${ms[$m]}" || fg="&7" bg="&B0"
            
            #~ ((w)) => desktop with windows
            ((w)) && ((! c)) && fg="&2" bg="&B6" 
            
            #~ ((u)) => desktop with urgent messages
            ((u)) && fg="&9" bg="&B0"
            
            r+="$fg$bg${ds[$d]}"
        done
        r="${r%::*}"
        printf "%s\n" "$r &B0&2$i"
    fi

done < "$ff" | bipolarbar &

conky -c ~/.config/conky/conky_monsterwm| while read -r; do xsetroot -name "$REPLY"; done &

monsterwm > "$ff"

rm $ff
